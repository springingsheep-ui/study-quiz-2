<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大乘解行研經班期末考線上刷題複習系統</title>
    <style>
        :root {
            --primary-brown: #5d4037;
            --light-brown: #8d6e63;
            --bg-color: #f5f5f0;
            --card-bg: #ffffff;
            --correct-green: #4caf50;
            --wrong-red: #f44336;
        }

        body {
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: var(--primary-brown);
            margin-bottom: 30px;
            border-bottom: 2px solid var(--light-brown);
            padding-bottom: 15px;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            background: #fdfdfd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            border: 1px solid #eee;
            text-align: center;
            font-weight: bold;
        }

        .config-panel {
            background: #fafafa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #ddd;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-brown);
        }

        select {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        button {
            flex: 1;
            padding: 12px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-start { background-color: var(--primary-brown); color: white; }
        .btn-reset { background-color: #9e9e9e; color: white; }
        .btn-finish { background-color: var(--light-brown); color: white; }
        button:hover { opacity: 0.9; transform: translateY(-2px); }

        .hint {
            text-align: center;
            color: #777;
            font-size: 14px;
            margin-top: 15px;
        }

        .question-item {
            border-bottom: 1px solid #eee;
            padding: 25px 0;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .options-container {
            margin-top: 15px;
            display: grid;
            gap: 10px;
        }

        .option-btn {
            padding: 12px 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            text-align: left;
            cursor: pointer;
            transition: 0.2s;
            font-size: 16px;
        }

        .option-btn:hover { background-color: #f0f0f0; }
        .option-btn.correct { background-color: #e8f5e9; border-color: var(--correct-green); color: var(--correct-green); font-weight: bold; }
        .option-btn.wrong { background-color: #ffebee; border-color: var(--wrong-red); color: var(--wrong-red); }

        #result-modal {
            display: none;
            text-align: center;
            padding: 40px;
            background: #fff;
            border: 3px solid var(--primary-brown);
            border-radius: 15px;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>大乘解行研經班期末考線上刷題複習系統</h1>

    <div class="stats-bar">
        <div>總題數: <span id="total-q">0</span></div>
        <div>已答: <span id="answered-q">0 / 0</span></div>
        <div>答對: <span id="correct-q">0</span></div>
    </div>

    <div class="config-panel">
        <div class="form-group">
            <label>分類搜尋章節：</label>
            <select id="chapter-filter">
                <option value="all">全部章節</option>
                <option value="1">（一）菩提自性是修行根本</option>
                <option value="2">（二）修行由信解自性開始</option>
                <option value="3">（三）自性世界因不同體悟而開展</option>
                <option value="45">（四、五）迷時師度/日用修行</option>
                <option value="6">（六）圓滿人人本具的自性</option>
                <option value="7">（七）大智慧到彼岸</option>
                <option value="810">（八、九、十）無念、無相、無住</option>
            </select>
        </div>

        <div class="form-group">
            <label>作答模式：</label>
            <select id="mode-filter">
                <option value="seq">依順序</option>
                <option value="random">隨機</option>
            </select>
        </div>

        <div class="form-group">
            <label>作答題數：</label>
            <select id="count-filter">
                <option value="10">10 題</option>
                <option value="20">20 題</option>
                <option value="50">50 題</option>
                <option value="all">全部</option>
            </select>
        </div>

        <div class="btn-group">
            <button class="btn-start" onclick="initQuiz()">開始作答</button>
            <button class="btn-reset" onclick="resetPage()">重製</button>
            <button class="btn-finish" onclick="showResults()">完成並看成績</button>
        </div>
        <div class="hint">請選擇章節與題數後，按下「開始作答」</div>
    </div>

    <div id="quiz-area"></div>
    <div id="result-modal"></div>
</div>

<script>
    // 題庫數據庫
    const rawData = [
        // 章節一 [cite: 1]
        { ch: "1", type: "TF", q: "成佛須「三祇修福慧，百劫修相好」，即使始終不明白心性之理，只要經過三大阿僧祇劫的用功，還是可以成就佛道。", a: "✕" },
        { ch: "1", type: "TF", q: "「菩提自性是修行根本」意指修行若離心性，就會失去真正的方向與根源。", a: "〇" },
        { ch: "1", type: "TF", q: "智慧是本性本空，要安住在空性當中。若還有個安住的念頭，便有個「能」，有能就有「所」，那就是方便了。", a: "〇" },
        { ch: "1", type: "TF", q: "任何法門修到一個頂點後，關鍵在於「安住大乘心」，意即安住於實相，這是修行的「根本」。", a: "〇" },
        { ch: "1", type: "TF", q: "為了明心見性，修六波羅蜜、念佛、禮誦等，這些都屬於加功用行。", a: "〇" },
        { ch: "1", type: "TF", q: "大乘心（菩提心）即是覺心，是一種在因當中廣積福德資糧，累積而來的智慧。", a: "✕" },
        { ch: "1", type: "TF", q: "《壇經》中六祖曰：「菩提自性，本來清淨，但用此心，直了成佛。」因佛性本具，故不用修行，即成佛道。", a: "✕" },
        { ch: "1", type: "TF", q: "「明心見性」是悟到本具的佛性；覺性本性本空，在本性本空當中不能生萬法。", a: "✕" },
        { ch: "1", type: "MC", q: "《楞伽經》告訴我們「雖自性淨」，但眾生「猶見不淨」，是何緣故？", opt: ["客塵所覆故", "攀緣執取", "顛倒妄想", "以上皆是"], a: 4 },
        { ch: "1", type: "MC", q: "「既然十法界不離一心，則一切修法，都是修心」，下列敘述何者正確？", opt: ["心放不下就向下墮落", "除習氣就向上提升", "所有修行本質上都是在修養心性", "以上皆是"], a: 4 },
        { ch: "1", type: "MC", q: "為何說「心外的一切」都是「緣起性空」？", opt: ["因為心外萬法都是真實永恆的", "因為諸法性空，是仗因托緣而有", "因為本性本空，所以一切都是虛空", "以上皆是"], a: 2 },
        { ch: "1", type: "MC", q: "五祖開示《金剛經》至哪一句話時，惠能大師言下大悟？", opt: ["如是我聞", "凡所有相，皆是虛妄", "應無所住而生其心", "不識本心，學法無益"], a: 3 },
        { ch: "1", type: "MC", q: "為什麼要認識本真？", opt: ["以生滅心求不生不滅無有是處", "心性本具，但用此心直了成佛", "不識本心學法無益", "以上皆是"], a: 4 },
        { ch: "1", type: "MC", q: "根據「菩薩畏因，眾生畏果」，修行者在面對煩惱時應當如何？", opt: ["廣修六度以福報消除業障", "安住於空無境界中", "從因上、心上去用功", "祈求佛力加持承擔業報"], a: 3 },
        { ch: "1", type: "MC", q: "在佛法中，「安住空性」的涵義是指什麼？", opt: ["專注於呼吸", "保持安住不動的念頭", "當下這念心，不起心、不動念", "斷除所有煩惱習氣"], a: 3 },
        { ch: "1", type: "MC", q: "五祖云：「無上菩提，須得言下識自本心。」以下何者為「言下」之意？", opt: ["說話的當下即是", "在他人的言說中找答案", "聽聞後回去思惟", "以上皆是"], a: 1 },
        { ch: "1", type: "MC", q: "關於「菩提自性」的描述，下列哪一項是正確的？", opt: ["它是虛空一無所有", "必須向外學習智慧啟發", "不生不滅，在本性本空當中能生萬有", "體性是生滅的"], a: 3 },

        // 章節二 [cite: 2, 3]
        { ch: "2", type: "TF", q: "窺基大師說，信心的建立要藉由外善知識；理解則須自覺，非他人所能替代。", a: "〇" },
        { ch: "2", type: "TF", q: "「一闡提」不解不信，是為斷絕善根的人，所以不可能成佛。", a: "✕" },
        { ch: "2", type: "TF", q: "修行的過程，應讓信心從初信、正信、深信到證信。", a: "〇" },
        { ch: "2", type: "TF", q: "有智慧但無信心的人容易增長無明；有信心但無智慧的人容易增長邪見。", a: "✕" },
        { ch: "2", type: "TF", q: "若有眾生欲向大乘者，最初根本之業是依止「一實境界」修習信解。", a: "〇" },
        { ch: "2", type: "TF", q: "「信」首先要斷疑生信，「解」是從知解入門，最後還要「解悟」。", a: "〇" },
        { ch: "2", type: "TF", q: "佛法講行持有「內行外行」：內行須斷我法二執，外行修萬善細行。", a: "〇" },
        { ch: "2", type: "MC", q: "如何信解自性？", opt: ["知幻即離", "離幻即覺", "隨順覺性", "以上皆是"], a: 4 },
        { ch: "2", type: "MC", q: "根據《大般涅槃經》，哪兩種人會「謗佛法僧」？", opt: ["初發心者與悟解者", "斷我法執者與修萬善者", "瞋恚不生信心者及有信未解義者", "利根邪見與鈍根正見者"], a: 3 },
        { ch: "2", type: "MC", q: "關於信解自性，下列何者正確？", opt: ["有信無解增長邪見", "地前菩薩由信而解", "解而不信是鈍根人", "聞法信入是解悟之解"], a: 2 },
        { ch: "2", type: "MC", q: "六祖惠能聞何經語心即開悟？", opt: ["法華經", "華嚴經", "圓覺經", "金剛經"], a: 4 },

        // 章節三 [cite: 4, 5]
        { ch: "3", type: "TF", q: "六祖大師悟到體用不二、空有一如，就是要「無住生心」，起般若觀照。", a: "〇" },
        { ch: "3", type: "TF", q: "神秀大師「勿使惹塵埃」是指應讓自己完全遠離塵世不接觸人事物。", a: "✕" },
        { ch: "3", type: "TF", q: "事修就是要讓身口意三業時時保持清淨，心中真正光明清淨即可見性。", a: "〇" },
        { ch: "3", type: "TF", q: "惠能大師作「菩提本無樹」一偈，即已達到最高體用一如的實相境界。", a: "✕" },
        { ch: "3", type: "TF", q: "「應無所住而生其心」的「住」是指攀緣心。", a: "✕" },
        { ch: "3", type: "MC", q: "六祖大師偈子「本來無一物，何處惹塵埃」所揭示的理體是：", opt: ["空性、一切諸法畢竟空", "知幻即離", "妙有之理能生萬法", "漸修成道"], a: 1 },
        { ch: "3", type: "MC", q: "五祖對神秀說「只到門外，未入門內」，意指神秀屬於：", opt: ["悟到空性但執著空", "功德具足只欠印可", "執著於有為法，尚未契悟無為心", "有解悟但無實證"], a: 3 },
        { ch: "3", type: "MC", q: "下列何者為非？", opt: ["「菩提本無樹」意為菩提樹乃因緣假合是空性", "「明鏡亦非台」表心體無台可尋", "「本來無一物」意為一切法畢竟空", "「何處惹塵埃」意為菩提心染污即不得"], a: 4 },

        // 章節四、五 [cite: 6, 7]
        { ch: "45", type: "TF", q: "「觸物起照」指的是在接觸外境時能觀其虛妄，不為境轉。", a: "〇" },
        { ch: "45", type: "TF", q: "「終日喫飯，未曾咬著一粒米」告訴我們修行在日用間不被境惑即是解脫。", a: "〇" },
        { ch: "45", type: "TF", q: "佛言：「隨其心淨即佛土淨」，只有到了西方才能心淨土淨。", a: "✕" },
        { ch: "45", type: "TF", q: "善知識雖能指引方向，但不能替弟子開悟。", a: "〇" },
        { ch: "45", type: "MC", q: "所謂「外道」是指：", opt: ["執世界有造物主者", "執斷常知見者", "心外求道者", "以上皆是"], a: 4 },
        { ch: "45", type: "MC", q: "世尊食時著衣持缽乞食，須菩提大嘆希有，體悟到什麼？", opt: ["世尊具足威儀", "行住坐臥皆不離自性", "世尊食畢即敷座用功", "世尊和光同塵"], a: 2 },
        { ch: "45", type: "MC", q: "根據《大乘起信論》眾生欲成佛道，下列何者為是？", opt: ["可自斷煩惱入涅槃", "善知識使其外得悟境", "正因是本有，須善知識為緣引導方契自性", "正因即師度"], a: 3 },

        // 章節六 [cite: 8, 9]
        { ch: "6", type: "TF", q: "頓悟法門是無一法可得，連清淨法、出世法也了不可得。", a: "〇" },
        { ch: "6", type: "TF", q: "「事理不二」的意思是只要懂道理，不需要持戒、打坐實踐。", a: "✕" },
        { ch: "6", type: "TF", q: "六祖認為禪定解脫比見性更重要。", a: "✕" },
        { ch: "6", type: "MC", q: "有關於「佛性」，下列何者正確？", opt: ["不二之法", "非常非無常", "一闡提亦有", "以上皆是"], a: 4 },
        { ch: "6", type: "MC", q: "關於頓悟與漸修，下列正確的是：", opt: ["兩者矛盾", "頓悟為因漸修為果", "兩者互相融通沒有矛盾", "漸修從理入"], a: 3 },

        // 章節七 [cite: 10]
        { ch: "7", type: "TF", q: "「佛法在世間，不離世間覺」意指成無上菩提須從日常生活中覺照自心。", a: "〇" },
        { ch: "7", type: "TF", q: "「摩訶」是大，指見一切人善惡時，心中應百無所思。", a: "✕" },
        { ch: "7", type: "TF", q: "忍辱若無般若，雖可得端正果報，但無法證得寂滅忍。", a: "〇" },
        { ch: "7", type: "MC", q: "「摩訶般若波羅蜜」的意義是：", opt: ["大智慧成就無上正覺", "大慈悲得離苦", "大智慧到彼岸", "大智慧得證果"], a: 3 },
        { ch: "7", type: "MC", q: "關於「若真修道人，不見世間過」，下列正確的是：", opt: ["不管是非對錯", "見不賢而內自省", "不因別人的過失起煩惱", "以上皆是"], a: 4 },

        // 章節八、九、十 [cite: 11, 12]
        { ch: "810", type: "TF", q: "於諸法上，念念不住即無縛也，此是以「無住」為本。", a: "〇" },
        { ch: "810", type: "TF", q: "無念是禪宗根本，意思是心中沒有任何念頭。", a: "✕" },
        { ch: "810", type: "TF", q: "離相並不是離開世間，而不執著一切相。", a: "〇" },
        { ch: "810", type: "MC", q: "下列敘述何者為非？", opt: ["無念者念真如本性", "無念者即百物不思", "悟無念者萬法盡通", "佛的心是無念無住"], a: 2 },
        { ch: "810", type: "MC", q: "關於「無住」的正確理解是：", opt: ["住即是三際托空", "須常住善念", "對善惡兩者都不要執著", "不必修轉化習氣"], a: 3 },
        { ch: "810", type: "MC", q: "達磨祖師對梁武帝說「實無功德」原因是：", opt: ["梁武帝做錯了", "功德只從禪定得", "梁武帝執著善法求福而非功德", "不必行善"], a: 3 }
    ];

    let currentQuestions = [];
    let correctCount = 0;
    let answeredCount = 0;

    function initQuiz() {
        const chapter = document.getElementById('chapter-filter').value;
        const mode = document.getElementById('mode-filter').value;
        const count = document.getElementById('count-filter').value;

        // 篩選章節
        let filtered = chapter === 'all' ? [...rawData] : rawData.filter(x => x.ch === chapter);

        // 模式處理
        if (mode === 'random') {
            filtered = filtered.sort(() => Math.random() - 0.5);
        }

        // 題數限制
        const finalCount = count === 'all' ? filtered.length : Math.min(parseInt(count), filtered.length);
        currentQuestions = filtered.slice(0, finalCount);

        // 重設狀態
        correctCount = 0;
        answeredCount = 0;
        document.getElementById('result-modal').style.display = 'none';
        updateStats();
        renderQuiz();
    }

    function renderQuiz() {
        const area = document.getElementById('quiz-area');
        area.innerHTML = '';

        currentQuestions.forEach((item, idx) => {
            const div = document.createElement('div');
            div.className = 'question-item';
            div.innerHTML = `<p><strong>第 ${idx + 1} 題 [${item.type === 'TF' ? '是非' : '選擇'}]：</strong> ${item.q}</p>`;

            const optsDiv = document.createElement('div');
            optsDiv.className = 'options-container';

            const choices = item.type === 'TF' ? ['〇', '✕'] : item.opt;
            choices.forEach((c, cIdx) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = item.type === 'TF' ? c : `${cIdx + 1}. ${c}`;
                btn.onclick = () => checkAnswer(btn, idx, c, item.a, cIdx + 1);
                optsDiv.appendChild(btn);
            });

            div.appendChild(optsDiv);
            area.appendChild(div);
        });
    }

    function checkAnswer(btn, qIdx, selectedVal, correctVal, mcIdx) {
        const container = btn.parentElement;
        if (container.classList.contains('locked')) return;

        answeredCount++;
        let isCorrect = false;

        if (currentQuestions[qIdx].type === 'TF') {
            isCorrect = (selectedVal === correctVal);
        } else {
            isCorrect = (mcIdx === correctVal);
        }

        if (isCorrect) {
            btn.classList.add('correct');
            correctCount++;
        } else {
            btn.classList.add('wrong');
            // 找出正確的按鈕標示出來
            Array.from(container.children).forEach((child, i) => {
                if (currentQuestions[qIdx].type === 'TF') {
                    if (child.innerText === correctVal) child.classList.add('correct');
                } else {
                    if ((i + 1) === correctVal) child.classList.add('correct');
                }
            });
        }

        container.classList.add('locked');
        updateStats();
    }

    function updateStats() {
        document.getElementById('total-q').innerText = currentQuestions.length;
        document.getElementById('answered-q').innerText = `${answeredCount} / ${currentQuestions.length}`;
        document.getElementById('correct-q').innerText = correctCount;
    }

    function showResults() {
        if (currentQuestions.length === 0) return;
        const score = Math.round((correctCount / currentQuestions.length) * 100);
        const modal = document.getElementById('result-modal');
        modal.style.display = 'block';
        modal.innerHTML = `
            <h2>作答完成！</h2>
            <p style="font-size: 24px;">最終分數：<span style="color:var(--primary-brown)">${score}</span> 分</p>
            <p>答對題數：${correctCount} / ${currentQuestions.length}</p>
            <button class="btn-reset" onclick="resetPage()">關閉並重置</button>
        `;
        window.scrollTo({ top: modal.offsetTop, behavior: 'smooth' });
    }

    function resetPage() {
        location.reload();
    }
</script>

</body>
</html>
